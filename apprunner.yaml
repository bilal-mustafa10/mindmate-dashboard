version: 1.0
runtime: python3

build:
  commands:
    build:
      - pip install pipenv
      - pipenv install
    post-build:
      - python manage.py collectstatic --noinput
      - python manage.py migrate
  env:
    - name: DJANGO_SETTINGS_MODULE
      value: mindmateDashboard.settings.dev
    - name: AWS_SECRET_ACCESS_KEY
      value_from_secret: arn:aws:secretsmanager:eu-west-1:934032727132:secret:dev/mindmate/s3-AvdIc0::aws_secret_access_key
    - name: AWS_ACCESS_KEY_ID
      value_from_secret: arn:aws:secretsmanager:eu-west-1:934032727132:secret:dev/mindmate/s3-AvdIc0::aws_access_key_id
    - name: AWS_DEFAULT_REGION
      value: eu-west-2

run:
  runtime-version: 3.9
  command: pipenv run gunicorn mindmateDashboard.wsgi --log-file -
  network:
    port: 8000
    env: MY_APP_PORT
  env:
    - name: DJANGO_SETTINGS_MODULE
      value: mindmateDashboard.settings.dev
    - name: AWS_SECRET_ACCESS_KEY
      value_from_secret: arn:aws:secretsmanager:eu-west-1:934032727132:secret:dev/mindmate/s3-AvdIc0::aws_secret_access_key
    - name: AWS_ACCESS_KEY_ID
      value_from_secret: arn:aws:secretsmanager:eu-west-1:934032727132:secret:dev/mindmate/s3-AvdIc0::aws_access_key_id
